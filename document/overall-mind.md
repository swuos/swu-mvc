## 写在前面 ##

[openswu-android](https://github.com/swuos/openswu-android)这个项目已经存在了有一段时间了，第一个版本是由我们的[Mran](https://github.com/Mran)一个人完成的。得益于他所做的工作，让第一版的app实现了大部分的掌上西大的功能，包括成绩，课表，图书馆，一卡通以及西南大学校园网账号密码上网时代的移动端登录功能（后来校园网上网模式改变了，也就不再需要这个功能了）。

这些app数据来源都是Mran从校内网上去自己解析得到的，西大教务系统本身并没有对外提供访问的相关文档。而这还不是最让人觉得无奈的事，毕竟如果仅此而已的话，自己去解析一遍，也就不需要二次工作了。但是教务系统是善变的，经常由于一些规则的修改，让学生自己开发的客户端陷入停滞状态，无法访问数据。每次教务系统的变脸，客户端都需要重新分析，修改之后发布新的客户端，而功能上却没有任何的变化。

**作为一个学生而不是组织的时候，维护这样一个项目是非常消耗精力的。** 

即使拥有一个组织，按照这样的思路去维护，也只是饮鸩止渴。无非就是一个人的活分给几个人来完成，却没有带来任何的技术进步。

所以，开源协会的成员们汇聚在一起，决定采取新的解决方案，给项目定一个未来的发展方向。虽然最终决策是灵活变化的，但是目前为止可以得出下面的一些关键要点：

1. 客户端不需要再做看教务系统脸色行事这种无意义的改动。这并不会带来技术上的进步，反而让苦力活不断地重复执行。代价相对是较大的。
2. 我们需要一个web中间件，让这个中间件来干那些脏活累活。以后的校园网的任何细小的改变，用户都不会再体会到。比起让客户端每次都改完发布新版本，考虑市场审核时间等因素，后台的改动相对来说，代价完全能够接受。而且用户不用再等待客户端改完才能继续使用app，他们的等待时间将缩短到后台解决校园网改动带来的麻烦的时间。
3. 这个中间件绝对不只是一个麻烦的解决者角色，它能做更多的事，**是让整个项目良性发展的重中之重**
4. 整套项目将不再局限在学校内，校外也能直接使用app（qtmd渣渣vpn，we don't need you anymore!）

----------

所以，我们不能再局限于实现功能，而要把整个项目当做产品来看待。那么关注于swu-client2.0，我们需要一个更好的架构，更好的设计以及更多新鲜的血液。

## 架构组成 ##

### 1、MVC ###

整体项目架构采用了MVC模式，很古老但是很实用，当然到了Android端，MVC也需要做一些改变。

### 2、开源框架 ###

项目采用了大量的开源框架，框架的选择经过初步的审核之后应用到项目中，选取标准则是——**够用即可，并且让初学者也能学到一些不那么基础的知识。**

所以我们摒弃了RXJava + retrofit，我们pass掉了MVP，EventBus和ButterKnife等优秀的框架。那些对新手不友好的东西，我们都尽量帮忙过滤掉。

取而代之的是，我们选择了[OkHttp](https://github.com/square/okhttp)作为网络请求底层库，然后自己实现跨页面的数据传递设计，自己实现了简单的注解绑定view框架[ViewInjector](https://github.com/jianyuyouhun/ViewInjector)。

业务开发层上，我们采用了Glide图片加载框架，自己实现了动态权限申请框架[EZPermission](https://github.com/jianyuyouhun/EZPermission)。

### 3、二次封装 ###

网络请求需要封装，json解析需要封装。大部分重复代码也需要封装。实现MVC架构，我们也需要封装，一切的一切都在后面的详细章节中说明。

### 4、kotlin ###

kotlin对于新手来说可能不友好，但是这的确值得我们一试，所以我们决定部分简单页面采用kotlin实现，搬运了JakeWharton的kotterKnife并对其进行了一些扩展，同时EZPermission也采用kotlin来实现，然后针对java中的一些注入框架，采用kotlin进行了更优的处理。ModelKnife就在其中。

> 开源协会一直都希望新加入的成员能够从中学到东西。使用这些自己实现的框架也正是在于作者能够直接给予新手帮助。


----------

## 结语 ##

严格上来说，团队成员被自愿的pass掉了很多框架，[jianyuyouhun](https://github.com/jianyuyouhun)表示这个锅他接了。不管怎么说，最终大家同意了他的方案。

够用是第一原则，第二则是在有人遇到疑惑的时候，这些老人能够解释的通他们的每一点疑问。

5/31/2018 10:28:15 PM created by jianyuyouhun